<!DOCTYPE html>
<html>
<head>
    <title>Camera Stream</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.6.1/socket.io.min.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<header>
    <p id="connection">disconnected</p>
</header>
<body>
    <h1>Camera Stream</h1>
    <div style="justify-content: center; display: flex;">
        <img id="video" src=""  alt="Camera Stream">
    </div>
    <br>
    Last Frame: <samp id="time">NA</samp>
    
    <script type="text/javascript">
        // Connect to the Socket.IO server
        const socket =  io();

        // Listen for 'connect' events and update the connection status
        socket.on('connect', function() {
            document.getElementById('connection').innerText = 'connected';
            document.getElementById('connection').style.color = 'green';
        });
        socket.on('disconnect', function() {
            document.getElementById('connection').innerText = 'disconnected';
            document.getElementById('connection').style.color = 'red';
        });
        
        // Listen for 'new_frame' events and update the image
        socket.on('camera_frame', function(data) {
            const parsedData = JSON.parse(data);
            document.getElementById('video').src = 'data:image/jpeg;base64,' + parsedData.image;
            
            const date = new Date(parsedData.time * 1000);
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            const seconds = date.getSeconds().toString().padStart(2, '0');
            const formattedTime = `${hours}:${minutes}:${seconds}`;
            
            document.getElementById('time').innerText = formattedTime;
        });
    </script>
</body>
</html>